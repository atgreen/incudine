<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="incudine.css" />
    <title>Getting Started with Incudine - Part 4</title>
  </head>
  <body>
    <div id="content">
      <table class="navtutor">
        <tr>
          <th colspan="3" class="center">Getting Started with Incudine</th>
        </tr>
        <tr>
          <td style="width: 20%" class="left"><a href="tutorial_03.html">Part 3</a></td>
          <th style="width: 60%" class="center">Part 4</th>
          <td style="width: 20%" class="right"></td>
        </tr>
      </table>
      <hr>

      <p>
        <code>DSP-DEBUG</code> is an utility to debug a definition of a DSP.
        The syntax is the same of <code>DSP!</code> but <code>DSP-DEBUG</code>
        returns a function to call with the arguments of the DSP. The result of
        the evaluation of that function is the code generated by <code>DSP!</code>.
        Here is an example:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (dsp-debug foo (freq amp pos)
           (foreach-channel
             (cout (pan2 (osc *sine-table* freq amp 0 <span style="color: #b0c4de;">:linear</span>) pos))))
#&lt;FUNCTION (LAMBDA (FREQ AMP POS <span style="color: #98fb98;">&amp;OPTIONAL</span> ...)) {10085C184B}&gt;
<span class="prompt">SCRATCH&gt;</span> (funcall * 440 .3 .5)
(LAMBDA (INCUDINE.VUG::%DSP-NODE%)
  (DECLARE (OPTIMIZE SPEED (SAFETY 0))
           (TYPE NODE INCUDINE.VUG::%DSP-NODE%))
  (INCUDINE.VUG::WITH-DSP-PREAMBLE (#<span style="color: #b0c4de;">:DSP912</span> 'FOO #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>
                                    #<span style="color: #b0c4de;">:FREE-HOOK914</span>)
    (INCUDINE.VUG::WITH-FOREIGN-ARRAYS ((#<span style="color: #b0c4de;">:SMPVEC917</span> #<span style="color: #b0c4de;">:SMPVECW916</span> 'SAMPLE 7)
                                        (#<span style="color: #b0c4de;">:F32VEC919</span> #<span style="color: #b0c4de;">:F32VECW918</span> <span style="color: #b0c4de;">:FLOAT</span> 0)
                                        (#<span style="color: #b0c4de;">:F64VEC921</span> #<span style="color: #b0c4de;">:F64VECW920</span> <span style="color: #b0c4de;">:DOUBLE</span> 0)
                                        (#<span style="color: #b0c4de;">:I32VEC923</span> #<span style="color: #b0c4de;">:I32VECW922</span> <span style="color: #b0c4de;">:INT32</span> 0)
                                        (#<span style="color: #b0c4de;">:I64VEC925</span> #<span style="color: #b0c4de;">:I64VECW924</span> <span style="color: #b0c4de;">:INT64</span> 0)
                                        (#<span style="color: #b0c4de;">:PTRVEC927</span> #<span style="color: #b0c4de;">:PTRVECW926</span> <span style="color: #b0c4de;">:POINTER</span> 1))
      (INCUDINE.VUG::WITH-SAMPLE-VARIABLES ((#<span style="color: #b0c4de;">:ALPHA911</span> #<span style="color: #b0c4de;">:IN909</span> #<span style="color: #b0c4de;">:LODIV138906</span>
                                             #<span style="color: #b0c4de;">:FRAC136905</span> #<span style="color: #b0c4de;">:POS897</span> #<span style="color: #b0c4de;">:AMP896</span>
                                             #<span style="color: #b0c4de;">:FREQ895</span>)
                                            #<span style="color: #b0c4de;">:SMPVEC917</span> 'SAMPLE)
        (INCUDINE.VUG::WITH-FOREIGN-VARIABLES ((NIL #<span style="color: #b0c4de;">:F32VEC919</span> <span style="color: #b0c4de;">:FLOAT</span>)
                                               (NIL #<span style="color: #b0c4de;">:F64VEC921</span> <span style="color: #b0c4de;">:DOUBLE</span>)
                                               (NIL #<span style="color: #b0c4de;">:I32VEC923</span> <span style="color: #b0c4de;">:INT32</span>)
                                               (NIL #<span style="color: #b0c4de;">:I64VEC925</span> <span style="color: #b0c4de;">:INT64</span>)
                                               ((#<span style="color: #b0c4de;">:DATA133904</span>) #<span style="color: #b0c4de;">:PTRVEC927</span>
                                                <span style="color: #b0c4de;">:POINTER</span>))
          (SETF #<span style="color: #b0c4de;">:FREQ895</span> 440.0d0)
          (SETF #<span style="color: #b0c4de;">:AMP896</span> 0.3d0)
          (SETF #<span style="color: #b0c4de;">:POS897</span> 0.5d0)
          (LET* ((#<span style="color: #b0c4de;">:%BUFFER127898</span> *SINE-TABLE*)
                 (#<span style="color: #b0c4de;">:FREQ-INC130901</span> (SAMPLE-&gt;FIXNUM (* #<span style="color: #b0c4de;">:FREQ895</span> *CPS2INC*)))
                 (#<span style="color: #b0c4de;">:PHS131902</span> 0)
                 (#<span style="color: #b0c4de;">:MINUS-LOBITS132903</span> (- (BUFFER-LOBITS #<span style="color: #b0c4de;">:%BUFFER127898</span>))))
            (DECLARE (TYPE BUFFER #<span style="color: #b0c4de;">:%BUFFER127898</span>))
            (DECLARE (TYPE FIXNUM #<span style="color: #b0c4de;">:FREQ-INC130901</span>))
            (DECLARE (TYPE FIXNUM #<span style="color: #b0c4de;">:PHS131902</span>))
            (DECLARE (TYPE (INTEGER -24 0) #<span style="color: #b0c4de;">:MINUS-LOBITS132903</span>))
            (SETF #<span style="color: #b0c4de;">:DATA133904</span> (BUFFER-DATA #<span style="color: #b0c4de;">:%BUFFER127898</span>))
            (SETF #<span style="color: #b0c4de;">:LODIV138906</span> (BUFFER-LODIV #<span style="color: #b0c4de;">:%BUFFER127898</span>))
            (LET* ((#<span style="color: #b0c4de;">:LOMASK139907</span> (BUFFER-LOMASK #<span style="color: #b0c4de;">:%BUFFER127898</span>))
                   (#<span style="color: #b0c4de;">:MASK137908</span> (BUFFER-MASK #<span style="color: #b0c4de;">:%BUFFER127898</span>)))
              (DECLARE (TYPE NON-NEGATIVE-FIXNUM #<span style="color: #b0c4de;">:LOMASK139907</span>))
              (DECLARE (TYPE NON-NEGATIVE-FIXNUM #<span style="color: #b0c4de;">:MASK137908</span>))
              (SETF #<span style="color: #b0c4de;">:ALPHA911</span> (* +HALF-PI+ #<span style="color: #b0c4de;">:POS897</span>))
              (LABELS ()
                (PROGN
                 (SETF (GETHASH <span style="color: #ffa07a;">"FREQ"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (CONS
                          (LAMBDA (#<span style="color: #b0c4de;">:VALUE928</span>)
                            (DECLARE
                             (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                            (SETF #<span style="color: #b0c4de;">:FREQ895</span> (COERCE #<span style="color: #b0c4de;">:VALUE928</span> 'SAMPLE))
                            (SETF #<span style="color: #b0c4de;">:FREQ-INC130901</span>
                                    (SAMPLE-&gt;FIXNUM (* #<span style="color: #b0c4de;">:FREQ895</span> *CPS2INC*)))
                            (VALUES))
                          (LAMBDA ()
                            (DECLARE
                             (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                            #<span style="color: #b0c4de;">:FREQ895</span>)))
                 (SETF (GETHASH <span style="color: #ffa07a;">"AMP"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (CONS
                          (LAMBDA (#<span style="color: #b0c4de;">:VALUE929</span>)
                            (DECLARE
                             (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                            (SETF #<span style="color: #b0c4de;">:AMP896</span> (COERCE #<span style="color: #b0c4de;">:VALUE929</span> 'SAMPLE))
                            (VALUES))
                          (LAMBDA ()
                            (DECLARE
                             (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                            #<span style="color: #b0c4de;">:AMP896</span>)))
                 (SETF (GETHASH <span style="color: #ffa07a;">"POS"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (CONS
                          (LAMBDA (#<span style="color: #b0c4de;">:VALUE930</span>)
                            (DECLARE
                             (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                            (SETF #<span style="color: #b0c4de;">:POS897</span> (COERCE #<span style="color: #b0c4de;">:VALUE930</span> 'SAMPLE))
                            (SETF #<span style="color: #b0c4de;">:ALPHA911</span> (* +HALF-PI+ #<span style="color: #b0c4de;">:POS897</span>))
                            (VALUES))
                          (LAMBDA ()
                            (DECLARE
                             (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                            #<span style="color: #b0c4de;">:POS897</span>)))
                 (SETF (GETHASH (LIST <span style="color: #b0c4de;">:POINTER</span> <span style="color: #ffa07a;">"FREQ"</span>) #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (REDUCE-WARNINGS
                           (CONS (GET-POINTER #<span style="color: #b0c4de;">:FREQ895</span>)
                                 (LAMBDA ()
                                   (DECLARE
                                    (SB-EXT:MUFFLE-CONDITIONS
                                     SB-EXT:COMPILER-NOTE))
                                   (SETF #<span style="color: #b0c4de;">:FREQ-INC130901</span>
                                           (SAMPLE-&gt;FIXNUM
                                            (* #<span style="color: #b0c4de;">:FREQ895</span> *CPS2INC*)))))))
                 (SETF (GETHASH (LIST <span style="color: #b0c4de;">:POINTER</span> <span style="color: #ffa07a;">"AMP"</span>) #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (REDUCE-WARNINGS
                           (CONS (GET-POINTER #<span style="color: #b0c4de;">:AMP896</span>) (LAMBDA ()))))
                 (SETF (GETHASH (LIST <span style="color: #b0c4de;">:POINTER</span> <span style="color: #ffa07a;">"POS"</span>) #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (REDUCE-WARNINGS
                           (CONS (GET-POINTER #<span style="color: #b0c4de;">:POS897</span>)
                                 (LAMBDA ()
                                   (DECLARE
                                    (SB-EXT:MUFFLE-CONDITIONS
                                     SB-EXT:COMPILER-NOTE))
                                   (SETF #<span style="color: #b0c4de;">:ALPHA911</span> (* +HALF-PI+ #<span style="color: #b0c4de;">:POS897</span>))))))
                 (SETF (GETHASH <span style="color: #ffa07a;">"%CONTROL-LIST%"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (CONS NIL
                               (LAMBDA ()
                                 (DECLARE
                                  (SB-EXT:MUFFLE-CONDITIONS
                                   SB-EXT:COMPILER-NOTE))
                                 (LIST #<span style="color: #b0c4de;">:FREQ895</span> #<span style="color: #b0c4de;">:AMP896</span> #<span style="color: #b0c4de;">:POS897</span>))))
                 (SETF (GETHASH <span style="color: #ffa07a;">"%CONTROL-NAMES%"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                         (CONS NIL (LAMBDA () '(FREQ AMP POS)))))
                NIL
                (PROGN
                 (SETF (INCUDINE.VUG::DSP-NAME #<span style="color: #b0c4de;">:DSP912</span>) 'FOO)
                 (SETF (INCUDINE::NODE-CONTROLS INCUDINE.VUG::%DSP-NODE%)
                         #<span style="color: #b0c4de;">:CONTROL-TABLE913</span>)
                 (INCUDINE.VUG::UPDATE-FREE-HOOK INCUDINE.VUG::%DSP-NODE%
                                                 #<span style="color: #b0c4de;">:FREE-HOOK914</span>)
                 (INCUDINE.VUG::SET-DSP-OBJECT #<span style="color: #b0c4de;">:DSP912</span> <span style="color: #b0c4de;">:INIT-FUNCTION</span>
                                               (LAMBDA (#<span style="color: #b0c4de;">:NODE915</span> FREQ AMP POS)
                                                 (DECLARE
                                                  (SB-EXT:MUFFLE-CONDITIONS
                                                   SB-EXT:COMPILER-NOTE))
                                                 (INCUDINE.VUG::RESET-FOREIGN-ARRAYS
                                                  #<span style="color: #b0c4de;">:SMPVEC917</span> 7 8 #<span style="color: #b0c4de;">:F32VEC919</span> 0
                                                  4 #<span style="color: #b0c4de;">:F64VEC921</span> 0 8 #<span style="color: #b0c4de;">:I32VEC923</span>
                                                  0 4 #<span style="color: #b0c4de;">:I64VEC925</span> 0 8
                                                  #<span style="color: #b0c4de;">:PTRVEC927</span> 1 8)
                                                 (SETF (INCUDINE::NODE-CONTROLS
                                                        #<span style="color: #b0c4de;">:NODE915</span>)
                                                         (INCUDINE.VUG::DSP-CONTROLS
                                                          #<span style="color: #b0c4de;">:DSP912</span>))
                                                 (SETF INCUDINE.VUG::%DSP-NODE%
                                                         #<span style="color: #b0c4de;">:NODE915</span>)
                                                 (PROGN
                                                  (SETF #<span style="color: #b0c4de;">:FREQ895</span>
                                                          (COERCE FREQ
                                                                  'SAMPLE))
                                                  (SETF #<span style="color: #b0c4de;">:AMP896</span>
                                                          (COERCE AMP 'SAMPLE))
                                                  (SETF #<span style="color: #b0c4de;">:POS897</span>
                                                          (COERCE POS 'SAMPLE))
                                                  (SETF #<span style="color: #b0c4de;">:%BUFFER127898</span>
                                                          *SINE-TABLE*)
                                                  (SETF #<span style="color: #b0c4de;">:FREQ-INC130901</span>
                                                          (SAMPLE-&gt;FIXNUM
                                                           (* #<span style="color: #b0c4de;">:FREQ895</span>
                                                              *CPS2INC*)))
                                                  (SETF #<span style="color: #b0c4de;">:PHS131902</span> 0)
                                                  (SETF #<span style="color: #b0c4de;">:MINUS-LOBITS132903</span>
                                                          (-
                                                           (BUFFER-LOBITS
                                                            #<span style="color: #b0c4de;">:%BUFFER127898</span>)))
                                                  (SETF #<span style="color: #b0c4de;">:DATA133904</span>
                                                          (BUFFER-DATA
                                                           #<span style="color: #b0c4de;">:%BUFFER127898</span>))
                                                  (SETF #<span style="color: #b0c4de;">:LODIV138906</span>
                                                          (BUFFER-LODIV
                                                           #<span style="color: #b0c4de;">:%BUFFER127898</span>))
                                                  (SETF #<span style="color: #b0c4de;">:LOMASK139907</span>
                                                          (BUFFER-LOMASK
                                                           #<span style="color: #b0c4de;">:%BUFFER127898</span>))
                                                  (SETF #<span style="color: #b0c4de;">:MASK137908</span>
                                                          (BUFFER-MASK
                                                           #<span style="color: #b0c4de;">:%BUFFER127898</span>))
                                                  (SETF #<span style="color: #b0c4de;">:ALPHA911</span>
                                                          (* +HALF-PI+
                                                             #<span style="color: #b0c4de;">:POS897</span>)))
                                                 (INCUDINE.VUG::UPDATE-FREE-HOOK
                                                  #<span style="color: #b0c4de;">:NODE915</span> #<span style="color: #b0c4de;">:FREE-HOOK914</span>)
                                                 #<span style="color: #b0c4de;">:NODE915</span>)
                                               <span style="color: #b0c4de;">:FREE-FUNCTION</span>
                                               (LAMBDA ()
                                                 (FREE #<span style="color: #b0c4de;">:SMPVECW916</span>)
                                                 (FREE #<span style="color: #b0c4de;">:PTRVECW926</span>))
                                               <span style="color: #b0c4de;">:PERF-FUNCTION</span>
                                               (LAMBDA ()
                                                 (LET ((CURRENT-CHANNEL 0))
                                                   (DECLARE
                                                    (TYPE CHANNEL-NUMBER
                                                     CURRENT-CHANNEL)
                                                    (IGNORABLE
                                                     CURRENT-CHANNEL))
                                                   (BLOCK NIL
                                                     (LET ((#<span style="color: #b0c4de;">:I124</span> 0))
                                                       (DECLARE
                                                        (TYPE CHANNEL-NUMBER
                                                         #<span style="color: #b0c4de;">:I124</span>))
                                                       (TAGBODY
                                                         (GO #<span style="color: #b0c4de;">:G126</span>)
                                                        #<span style="color: #b0c4de;">:G125</span>
                                                         (TAGBODY
                                                           (LET ((CURRENT-CHANNEL
                                                                  #<span style="color: #b0c4de;">:I124</span>))
                                                             (DECLARE
                                                              (TYPE
                                                               CHANNEL-NUMBER
                                                               CURRENT-CHANNEL)
                                                              (IGNORABLE
                                                               CURRENT-CHANNEL))
                                                             (PROGN
                                                              NIL
                                                              (INCF
                                                               (AUDIO-OUT
                                                                CURRENT-CHANNEL)
                                                               (COERCE
                                                                (IF (=
                                                                     CURRENT-CHANNEL
                                                                     0)
                                                                    (*
                                                                     (COS
                                                                      #<span style="color: #b0c4de;">:ALPHA911</span>)
                                                                     (SETF #<span style="color: #b0c4de;">:IN909</span>
                                                                             (PROGN
                                                                              (VALUES)
                                                                              (LET ((#<span style="color: #b0c4de;">:INDEX134</span>
                                                                                     (THE
                                                                                      FIXNUM
                                                                                      (INCUDINE.VUG::ASH
                                                                                       #<span style="color: #b0c4de;">:PHS131902</span>
                                                                                       #<span style="color: #b0c4de;">:MINUS-LOBITS132903</span>))))
                                                                                (LET ((#<span style="color: #b0c4de;">:G135</span>
                                                                                       (*
                                                                                        #<span style="color: #b0c4de;">:AMP896</span>
                                                                                        (PROGN
                                                                                         (SETF #<span style="color: #b0c4de;">:FRAC136905</span>
                                                                                                 (*
                                                                                                  #<span style="color: #b0c4de;">:LODIV138906</span>
                                                                                                  (LOGAND
                                                                                                   #<span style="color: #b0c4de;">:PHS131902</span>
                                                                                                   #<span style="color: #b0c4de;">:LOMASK139907</span>)))
                                                                                         (LINEAR-INTERP
                                                                                          #<span style="color: #b0c4de;">:FRAC136905</span>
                                                                                          (CFFI:MEM-REF
                                                                                           #<span style="color: #b0c4de;">:DATA133904</span>
                                                                                           'SAMPLE
                                                                                           (THE
                                                                                            NON-NEGATIVE-FIXNUM
                                                                                            (*
                                                                                             #<span style="color: #b0c4de;">:INDEX134</span>
                                                                                             +FOREIGN-SAMPLE-SIZE+)))
                                                                                          (CFFI:MEM-REF
                                                                                           #<span style="color: #b0c4de;">:DATA133904</span>
                                                                                           'SAMPLE
                                                                                           (THE
                                                                                            NON-NEGATIVE-FIXNUM
                                                                                            (*
                                                                                             (LOGAND
                                                                                              (THE
                                                                                               FIXNUM
                                                                                               (1+
                                                                                                #<span style="color: #b0c4de;">:INDEX134</span>))
                                                                                              #<span style="color: #b0c4de;">:MASK137908</span>)
                                                                                             +FOREIGN-SAMPLE-SIZE+))))))))
                                                                                  (SETF #<span style="color: #b0c4de;">:PHS131902</span>
                                                                                          (LOGAND
                                                                                           (THE
                                                                                            FIXNUM
                                                                                            (+
                                                                                             #<span style="color: #b0c4de;">:PHS131902</span>
                                                                                             #<span style="color: #b0c4de;">:FREQ-INC130901</span>))
                                                                                           +PHASE-MASK+))
                                                                                  #<span style="color: #b0c4de;">:G135</span>)))))
                                                                    (IF (=
                                                                         CURRENT-CHANNEL
                                                                         1)
                                                                        (*
                                                                         (SIN
                                                                          #<span style="color: #b0c4de;">:ALPHA911</span>)
                                                                         #<span style="color: #b0c4de;">:IN909</span>)
                                                                        (THE T
                                                                             +SAMPLE-ZERO+)))
                                                                'SAMPLE))
                                                              (VALUES))))
                                                         (PSETQ #<span style="color: #b0c4de;">:I124</span>
                                                                  (1+ #<span style="color: #b0c4de;">:I124</span>))
                                                        #<span style="color: #b0c4de;">:G126</span>
                                                         (IF (&gt;= #<span style="color: #b0c4de;">:I124</span>
                                                                 *NUMBER-OF-OUTPUT-BUS-CHANNELS*)
                                                             NIL
                                                             (GO #<span style="color: #b0c4de;">:G125</span>))
                                                         (RETURN-FROM NIL
                                                           NIL))))
                                                   (VALUES))))
                 (VALUES (INCUDINE.VUG::DSP-INIT-FUNCTION #<span style="color: #b0c4de;">:DSP912</span>)
                         (INCUDINE.VUG::DSP-PERF-FUNCTION #<span style="color: #b0c4de;">:DSP912</span>)))))))))))</pre>

      <p>
        The generated code is divided in the following parts:
      </p>

      <ul>
        <li>Initialization</li>
        <li>Set the hash-table for the controls</li>
        <li>Set the function to re-initialize the instance of a DSP</li>
        <li>Set the function to free the memory when the game is over</li>
        <li>Set the function to perform on each tick</li>
      </ul>

      <p>
        The <code>FREE-DSP-INSTANCES</code> function is useful to free the
        memory pool for the instances of one or all DSPs.
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (free-dsp-instances)
<span class="prompt">SCRATCH&gt;</span> (get-foreign-sample-free-size)
67102464
<span class="prompt">SCRATCH&gt;</span> (get-rt-memory-free-size)
67102464</pre>

      <p>
        <code>GET-FOREIGN-SAMPLE-FREE-SIZE</code> returns the free available
        memory for the allocations of <code>SAMPLE</code> type used inside the
        code generated by <code>DSP!</code>. We can set the size of the relative
        memory pool by changing the value of <code>*FOREIGN-SAMPLE-POOL-SIZE*</code>
        in <code>$HOME/.incudinerc</code> (the default is 64MB).
      </p>

      <p>
        <code>GET-RT-MEMORY-FREE-SIZE</code> returns the free available memory
        allocable in realtime on the C heap, without considering the allocations
        of <code>SAMPLE</code> type counted by <code>GET-FOREIGN-SAMPLE-FREE-SIZE</code>.
        We can set the size of the relative memory pool by changing the value of
        <code>*FOREIGN-RT-MEMORY-POOL-SIZE*</code> in <code>$HOME/.incudinerc</code>
        (the default is 64MB).
      </p>

      <p>
        <code>DESTROY-DSP</code> is useful to completely remove a DSP and all
        the associated memory.
      </p>

      <p>
        <code>ALL-DSP-NAMES</code> returns all the defined DSPs. We can use the
        combination of <code>DESTROY-DSP</code> and <code>ALL-DSP-NAMES</code>
        to remove all the defined DSP:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (mapc #'destroy-dsp (all-dsp-names))
<span class="prompt">SCRATCH&gt;</span> (all-dsp-names)
NIL</pre>

      <p>
        <a href="index.html">Incudine</a> has some facilities for diagnostics.
        There are four levels for the logger:
      </p>

      <ul>
        <li>error</li>
        <li>warn</li>
        <li>info</li>
        <li>debug</li>
      </ul>

      <p>
        Every level in the list enables the previous levels. It means that if
        <code>LOGGER-LEVEL</code> is <code>:DEBUG</code>, all the levels are
        enabled. If <code>LOGGER-LEVEL</code> is <code>:ERROR</code>, only the
        error messages are enabled. The default is <code>:WARN</code>.
      </p>

      <p>
        <code>*LOGGER-STREAM*</code> is <code>*STANDARD-OUTPUT*</code> and
        <code>*LOGGER-FORCE-OUTPUT-P*</code> is T by default.
      </p>

      <p>
        Some examples:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (logger-level)
<span style="color: #b0c4de;">:WARN</span>
<span class="prompt">SCRATCH&gt;</span> (msg error <span style="color: #ffa07a;">"wrong direction"</span>)
ERROR: wrong direction
NIL
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"the DSP can explode"</span>)
WARN: the DSP can explode
NIL
<span class="prompt">SCRATCH&gt;</span> (msg info <span style="color: #ffa07a;">"new group ~A"</span> (1+ (random 100)))
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:info</span>)
<span style="color: #b0c4de;">:INFO</span>
<span class="prompt">SCRATCH&gt;</span> (msg info <span style="color: #ffa07a;">"new group ~A"</span> (1+ (random 100)))
new group 42
NIL
<span class="prompt">SCRATCH&gt;</span> (msg debug <span style="color: #ffa07a;">"the value of FREQ is ~,2F"</span> (random 1000.0))
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:debug</span>)
<span style="color: #b0c4de;">:DEBUG</span>
<span class="prompt">SCRATCH&gt;</span> (msg debug <span style="color: #ffa07a;">"the value of FREQ is ~,2F"</span> (random 1000.0))
DEBUG: the value of FREQ is 826.75
NIL
<span class="prompt">SCRATCH&gt;</span> (msg info <span style="color: #ffa07a;">"free all nodes"</span>)
free all nodes
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:error</span>)
<span style="color: #b0c4de;">:ERROR</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"a wolf!"</span>)
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:warn</span>)
<span style="color: #b0c4de;">:WARN</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"a wolf!"</span>)
WARN: a wolf!
NIL
<span class="prompt">SCRATCH&gt;</span> (msg error <span style="color: #ffa07a;">"unknown device"</span>)
ERROR: unknown device
NIL</pre>

      <p>
        <code>LOGGER-TIME</code> is useful to show the time of the message.
        The possible values for <code>LOGGER-TIME</code> are <code>:SEC</code>
        (seconds) and <code>:SAMP</code> (samples)
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (logger-time)
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time) <span style="color: #b0c4de;">:sec</span>)
<span style="color: #b0c4de;">:SEC</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"too late"</span>)
13878.763 WARN: too late
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time) <span style="color: #b0c4de;">:samp</span>)
<span style="color: #b0c4de;">:SAMP</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"too late"</span>)
667113472.0 WARN: too late
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time-function)
               (lambda ()
                 (let ((seconds-p (eq (logger-time) <span style="color: #b0c4de;">:sec</span>)))
                   (format *logger-stream* <span style="color: #ffa07a;">"[~:[~,1F~;~,3F~]] "</span> seconds-p
                           (* (now) (if seconds-p *sample-duration* 1))))))
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"LOGGER-TIME-FUNCTION redefined"</span>)
[675466240.0] WARN: LOGGER-TIME-FUNCTION redefined
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time-function) nil)
#&lt;FUNCTION INCUDINE.UTIL::DEFAULT-LOGGER-TIME-FUNCTION&gt;
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time) nil)
NIL</pre>

      <p>
        We have to use <code>NRT-MSG</code> instead of <code>MSG</code>
        for the messages in the realtime thread. For example:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (rt-eval () (msg warn <span style="color: #ffa07a;">"Don't use MSG in the rt thread!"</span>)) <span style="color: #ff7f24;">; </span><span style="color: #ff7f24;">wrong</span>
WARN: Don't use MSG in the rt thread!
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:info</span>)
<span style="color: #b0c4de;">:INFO</span>
<span class="prompt">SCRATCH&gt;</span> (rt-eval () (nrt-msg info <span style="color: #ffa07a;">"Ok, NRT-MSG is good in the rt thread"</span>))
Ok, NRT-MSG is good in the rt thread
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:warn</span>)
<span style="color: #b0c4de;">:WARN</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"~A"</span> (map 'string #'code-char '(84 72 69 32 69 78 68)))
WARN: THE END</pre>

      <hr>
      <table class="navtutor">
        <tr>
          <td style="width: 20%" class="left"><a href="tutorial_03.html">Part 3</a></td>
          <td style="width: 60%" class="center"><a href="index.html">Home</a></td>
          <td style="width: 20%" class="right"></td>
        </tr>
      </table>
    </div>
    <div id="postamble">
      <a href="http://sourceforge.net/projects/incudine">Sourceforge project page</a>
    </div>
  </body>
</html>
