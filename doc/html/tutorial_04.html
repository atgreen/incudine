<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="incudine.css" />
    <title>Getting Started with Incudine - Part 4</title>
  </head>
  <body>
    <div id="content">
      <table class="navtutor">
        <tr>
          <th colspan="3" class="center">Getting Started with Incudine</th>
        </tr>
        <tr>
          <td style="width: 20%" class="left"><a href="tutorial_03.html">Part 3</a></td>
          <th style="width: 60%" class="center">Part 4</th>
          <td style="width: 20%" class="right"></td>
        </tr>
      </table>
      <hr>

      <p>
        <code>DSP-DEBUG</code> is an utility to inspect the code generated by the
        <code>DSP!</code> macro. The syntax is the same of <code>DSP!</code> but
        <code>DSP-DEBUG</code> returns a function to call with the DSP arguments.
        The result of the evaluation of that function is the code generated by
        <code>DSP!</code>. Here is an example:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (dsp-debug foo (freq amp pos)
           (foreach-channel
             (cout (pan2 (osc *sine-table* freq amp 0 <span style="color: #b0c4de;">:linear</span>) pos))))
#&lt;FUNCTION (LAMBDA (FREQ AMP POS <span style="color: #98fb98;">&amp;OPTIONAL</span> ...)) {10085C184B}&gt;
<span class="prompt">SCRATCH&gt;</span> (funcall * 440 .3 .5)
(<span style="color: #8deeee;">LAMBDA</span> (INCUDINE.VUG::%DSP-NODE%)
  (<span style="color: #8deeee;">DECLARE</span> (OPTIMIZE SPEED (SAFETY 0))
           (TYPE NODE INCUDINE.VUG::%DSP-NODE%))
  (INCUDINE.VUG::WITH-DSP-PREAMBLE (#<span style="color: #b0c4de;">:DSP538</span> 'FOO #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>
                                    #<span style="color: #b0c4de;">:TO-FREE540</span> #<span style="color: #b0c4de;">:FREE-HOOK541</span>)
    (INCUDINE.VUG::WITH-FOREIGN-ARRAYS ((#<span style="color: #b0c4de;">:SMPVEC544</span> #<span style="color: #b0c4de;">:SMPVECW543</span> 'SAMPLE 9)
                                        (#<span style="color: #b0c4de;">:F32VEC546</span> #<span style="color: #b0c4de;">:F32VECW545</span> <span style="color: #b0c4de;">:FLOAT</span> 0)
                                        (#<span style="color: #b0c4de;">:F64VEC548</span> #<span style="color: #b0c4de;">:F64VECW547</span> <span style="color: #b0c4de;">:DOUBLE</span> 0)
                                        (#<span style="color: #b0c4de;">:I32VEC550</span> #<span style="color: #b0c4de;">:I32VECW549</span> <span style="color: #b0c4de;">:INT32</span> 0)
                                        (#<span style="color: #b0c4de;">:I64VEC552</span> #<span style="color: #b0c4de;">:I64VECW551</span> <span style="color: #b0c4de;">:INT64</span> 0)
                                        (#<span style="color: #b0c4de;">:PTRVEC554</span> #<span style="color: #b0c4de;">:PTRVECW553</span> <span style="color: #b0c4de;">:POINTER</span> 1))
      (INCUDINE.VUG::WITH-SAMPLE-VARIABLES ((#<span style="color: #b0c4de;">:FREQ518</span> #<span style="color: #b0c4de;">:AMP519</span> #<span style="color: #b0c4de;">:POS520</span>
                                             #<span style="color: #b0c4de;">:FRAC85529</span> #<span style="color: #b0c4de;">:LODIV87530</span> #<span style="color: #b0c4de;">:IN533</span>
                                             #<span style="color: #b0c4de;">:ALPHA535</span> #<span style="color: #b0c4de;">:LEFT536</span> #<span style="color: #b0c4de;">:RIGHT537</span>)
                                            #<span style="color: #b0c4de;">:SMPVEC544</span> 'SAMPLE)
        (INCUDINE.VUG::WITH-FOREIGN-VARIABLES ((NIL #<span style="color: #b0c4de;">:F32VEC546</span> <span style="color: #b0c4de;">:FLOAT</span>)
                                               (NIL #<span style="color: #b0c4de;">:F64VEC548</span> <span style="color: #b0c4de;">:DOUBLE</span>)
                                               (NIL #<span style="color: #b0c4de;">:I32VEC550</span> <span style="color: #b0c4de;">:INT32</span>)
                                               (NIL #<span style="color: #b0c4de;">:I64VEC552</span> <span style="color: #b0c4de;">:INT64</span>)
                                               ((#<span style="color: #b0c4de;">:DATA80528</span>) #<span style="color: #b0c4de;">:PTRVEC554</span>
                                                <span style="color: #b0c4de;">:POINTER</span>))
          (INCUDINE.VUG::WITH-INIT-FRAMES
            (SETF #<span style="color: #b0c4de;">:FREQ518</span> 440.0d0)
            (SETF #<span style="color: #b0c4de;">:AMP519</span> 0.3d0)
            (SETF #<span style="color: #b0c4de;">:POS520</span> 0.5d0)
            (<span style="color: #8deeee;">LET*</span> ((#<span style="color: #b0c4de;">:BUF521</span> *SINE-TABLE*)
                   (#<span style="color: #b0c4de;">:FREQ-INC77525</span> (SAMPLE-&gt;FIXNUM (* #<span style="color: #b0c4de;">:FREQ518</span> *CPS2INC*)))
                   (#<span style="color: #b0c4de;">:PHS78526</span> 0)
                   (#<span style="color: #b0c4de;">:MINUS-LOBITS79527</span> (- (BUFFER-LOBITS #<span style="color: #b0c4de;">:BUF521</span>))))
              (<span style="color: #8deeee;">DECLARE</span> (TYPE BUFFER #<span style="color: #b0c4de;">:BUF521</span>))
              (<span style="color: #8deeee;">DECLARE</span> (TYPE FIXNUM #<span style="color: #b0c4de;">:FREQ-INC77525</span>))
              (<span style="color: #8deeee;">DECLARE</span> (TYPE FIXNUM #<span style="color: #b0c4de;">:PHS78526</span>))
              (<span style="color: #8deeee;">DECLARE</span> (TYPE (INTEGER -24 0) #<span style="color: #b0c4de;">:MINUS-LOBITS79527</span>))
              (SETF #<span style="color: #b0c4de;">:DATA80528</span> (BUFFER-DATA #<span style="color: #b0c4de;">:BUF521</span>))
              (SETF #<span style="color: #b0c4de;">:LODIV87530</span> (BUFFER-LODIV #<span style="color: #b0c4de;">:BUF521</span>))
              (<span style="color: #8deeee;">LET*</span> ((#<span style="color: #b0c4de;">:LOMASK88531</span> (BUFFER-LOMASK #<span style="color: #b0c4de;">:BUF521</span>))
                     (#<span style="color: #b0c4de;">:MASK86532</span> (BUFFER-MASK #<span style="color: #b0c4de;">:BUF521</span>)))
                (<span style="color: #8deeee;">DECLARE</span> (TYPE NON-NEGATIVE-FIXNUM #<span style="color: #b0c4de;">:LOMASK88531</span>))
                (<span style="color: #8deeee;">DECLARE</span> (TYPE NON-NEGATIVE-FIXNUM #<span style="color: #b0c4de;">:MASK86532</span>))
                (SETF #<span style="color: #b0c4de;">:ALPHA535</span> (* +HALF-PI+ #<span style="color: #b0c4de;">:POS520</span>))
                (SETF #<span style="color: #b0c4de;">:LEFT536</span> (COS #<span style="color: #b0c4de;">:ALPHA535</span>))
                (SETF #<span style="color: #b0c4de;">:RIGHT537</span> (SIN #<span style="color: #b0c4de;">:ALPHA535</span>))
                (<span style="color: #8deeee;">LABELS</span> ()
                  (<span style="color: #8deeee;">PROGN</span>
                   (SETF (GETHASH <span style="color: #ffa07a;">"FREQ"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (CONS
                            (<span style="color: #8deeee;">LAMBDA</span> (#<span style="color: #b0c4de;">:VALUE555</span>)
                              (<span style="color: #8deeee;">DECLARE</span>
                               (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                              (SETF #<span style="color: #b0c4de;">:FREQ518</span>
                                      (INCUDINE.UTIL::FORCE-SAMPLE-FORMAT
                                       #<span style="color: #b0c4de;">:VALUE555</span>))
                              (SETF #<span style="color: #b0c4de;">:FREQ-INC77525</span>
                                      (SAMPLE-&gt;FIXNUM (* #<span style="color: #b0c4de;">:FREQ518</span> *CPS2INC*)))
                              (VALUES))
                            (<span style="color: #8deeee;">LAMBDA</span> ()
                              (<span style="color: #8deeee;">DECLARE</span>
                               (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                              #<span style="color: #b0c4de;">:FREQ518</span>)))
                   (SETF (GETHASH <span style="color: #ffa07a;">"AMP"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (CONS
                            (<span style="color: #8deeee;">LAMBDA</span> (#<span style="color: #b0c4de;">:VALUE556</span>)
                              (<span style="color: #8deeee;">DECLARE</span>
                               (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                              (SETF #<span style="color: #b0c4de;">:AMP519</span>
                                      (INCUDINE.UTIL::FORCE-SAMPLE-FORMAT
                                       #<span style="color: #b0c4de;">:VALUE556</span>))
                              (VALUES))
                            (<span style="color: #8deeee;">LAMBDA</span> ()
                              (<span style="color: #8deeee;">DECLARE</span>
                               (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                              #<span style="color: #b0c4de;">:AMP519</span>)))
                   (SETF (GETHASH <span style="color: #ffa07a;">"POS"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (CONS
                            (<span style="color: #8deeee;">LAMBDA</span> (#<span style="color: #b0c4de;">:VALUE557</span>)
                              (<span style="color: #8deeee;">DECLARE</span>
                               (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                              (SETF #<span style="color: #b0c4de;">:POS520</span>
                                      (INCUDINE.UTIL::FORCE-SAMPLE-FORMAT
                                       #<span style="color: #b0c4de;">:VALUE557</span>))
                              (SETF #<span style="color: #b0c4de;">:ALPHA535</span> (* +HALF-PI+ #<span style="color: #b0c4de;">:POS520</span>))
                              (SETF #<span style="color: #b0c4de;">:LEFT536</span> (COS #<span style="color: #b0c4de;">:ALPHA535</span>))
                              (SETF #<span style="color: #b0c4de;">:RIGHT537</span> (SIN #<span style="color: #b0c4de;">:ALPHA535</span>))
                              (VALUES))
                            (<span style="color: #8deeee;">LAMBDA</span> ()
                              (<span style="color: #8deeee;">DECLARE</span>
                               (SB-EXT:MUFFLE-CONDITIONS SB-EXT:COMPILER-NOTE))
                              #<span style="color: #b0c4de;">:POS520</span>)))
                   (SETF (GETHASH (LIST <span style="color: #b0c4de;">:POINTER</span> <span style="color: #ffa07a;">"FREQ"</span>) #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (REDUCE-WARNINGS
                             (CONS (GET-POINTER #<span style="color: #b0c4de;">:FREQ518</span>)
                                   (<span style="color: #8deeee;">LAMBDA</span> ()
                                     (<span style="color: #8deeee;">DECLARE</span>
                                      (SB-EXT:MUFFLE-CONDITIONS
                                       SB-EXT:COMPILER-NOTE))
                                     (SETF #<span style="color: #b0c4de;">:FREQ-INC77525</span>
                                             (SAMPLE-&gt;FIXNUM
                                              (* #<span style="color: #b0c4de;">:FREQ518</span> *CPS2INC*)))))))
                   (SETF (GETHASH (LIST <span style="color: #b0c4de;">:POINTER</span> <span style="color: #ffa07a;">"AMP"</span>) #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (REDUCE-WARNINGS
                             (CONS (GET-POINTER #<span style="color: #b0c4de;">:AMP519</span>) (<span style="color: #8deeee;">LAMBDA</span> ()))))
                   (SETF (GETHASH (LIST <span style="color: #b0c4de;">:POINTER</span> <span style="color: #ffa07a;">"POS"</span>) #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (REDUCE-WARNINGS
                             (CONS (GET-POINTER #<span style="color: #b0c4de;">:POS520</span>)
                                   (<span style="color: #8deeee;">LAMBDA</span> ()
                                     (<span style="color: #8deeee;">DECLARE</span>
                                      (SB-EXT:MUFFLE-CONDITIONS
                                       SB-EXT:COMPILER-NOTE))
                                     (SETF #<span style="color: #b0c4de;">:ALPHA535</span> (* +HALF-PI+ #<span style="color: #b0c4de;">:POS520</span>))
                                     (SETF #<span style="color: #b0c4de;">:LEFT536</span> (COS #<span style="color: #b0c4de;">:ALPHA535</span>))
                                     (SETF #<span style="color: #b0c4de;">:RIGHT537</span> (SIN #<span style="color: #b0c4de;">:ALPHA535</span>))))))
                   (SETF (GETHASH <span style="color: #ffa07a;">"%CONTROL-LIST%"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (CONS NIL
                                 (<span style="color: #8deeee;">LAMBDA</span> ()
                                   (<span style="color: #8deeee;">DECLARE</span>
                                    (SB-EXT:MUFFLE-CONDITIONS
                                     SB-EXT:COMPILER-NOTE))
                                   (LIST #<span style="color: #b0c4de;">:FREQ518</span> #<span style="color: #b0c4de;">:AMP519</span> #<span style="color: #b0c4de;">:POS520</span>))))
                   (SETF (GETHASH <span style="color: #ffa07a;">"%CONTROL-NAMES%"</span> #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                           (CONS NIL (<span style="color: #8deeee;">LAMBDA</span> () '(FREQ AMP POS)))))
                  NIL
                  (<span style="color: #8deeee;">PROGN</span>
                   (SETF (INCUDINE.VUG::DSP-NAME #<span style="color: #b0c4de;">:DSP538</span>) 'FOO)
                   (SETF (INCUDINE::NODE-CONTROLS INCUDINE.VUG::%DSP-NODE%)
                           #<span style="color: #b0c4de;">:CONTROL-TABLE539</span>)
                   (INCUDINE.VUG::UPDATE-FREE-HOOK INCUDINE.VUG::%DSP-NODE%
                                                   #<span style="color: #b0c4de;">:FREE-HOOK541</span>)
                   (<span style="color: #8deeee;">PROGN</span>
                    (SETF #<span style="color: #b0c4de;">:PHS78526</span>
                            (LOGAND
                             (<span style="color: #8deeee;">THE</span> FIXNUM
                                  (+ #<span style="color: #b0c4de;">:PHS78526</span>
                                     (SAMPLE-&gt;FIXNUM (* 0.0d0 +RAD2INC+))))
                             +PHASE-MASK+)))
                   (SETF #<span style="color: #b0c4de;">:TO-FREE540</span> INCUDINE::*TO-FREE*)
                   (INCUDINE.VUG::SET-DSP-OBJECT #<span style="color: #b0c4de;">:DSP538</span> <span style="color: #b0c4de;">:INIT-FUNCTION</span>
                                                 (<span style="color: #8deeee;">LAMBDA</span>
                                                     (#<span style="color: #b0c4de;">:NODE542</span> FREQ AMP POS)
                                                   (<span style="color: #8deeee;">DECLARE</span>
                                                    (SB-EXT:MUFFLE-CONDITIONS
                                                     SB-EXT:COMPILER-NOTE))
                                                   (INCUDINE.VUG::RESET-FOREIGN-ARRAYS
                                                    #<span style="color: #b0c4de;">:SMPVEC544</span> 9 8 #<span style="color: #b0c4de;">:F32VEC546</span>
                                                    0 4 #<span style="color: #b0c4de;">:F64VEC548</span> 0 8
                                                    #<span style="color: #b0c4de;">:I32VEC550</span> 0 4 #<span style="color: #b0c4de;">:I64VEC552</span>
                                                    0 8 #<span style="color: #b0c4de;">:PTRVEC554</span> 1 8)
                                                   (SETF (INCUDINE::NODE-CONTROLS
                                                          #<span style="color: #b0c4de;">:NODE542</span>)
                                                           (INCUDINE.VUG::DSP-CONTROLS
                                                            #<span style="color: #b0c4de;">:DSP538</span>))
                                                   (SETF INCUDINE.VUG::%DSP-NODE%
                                                           #<span style="color: #b0c4de;">:NODE542</span>)
                                                   (SETF INCUDINE.VUG::*DSP-NODE*
                                                           #<span style="color: #b0c4de;">:NODE542</span>)
                                                   (INCUDINE.VUG::WITH-INIT-FRAMES
                                                     (INCUDINE.VUG::FREE-INCUDINE-OBJECTS
                                                      #<span style="color: #b0c4de;">:TO-FREE540</span>)
                                                     (<span style="color: #8deeee;">LET</span> ((INCUDINE::*TO-FREE*
                                                            NIL))
                                                       (<span style="color: #8deeee;">PROGN</span>
                                                        (SETF #<span style="color: #b0c4de;">:FREQ518</span>
                                                                (COERCE FREQ
                                                                        'SAMPLE))
                                                        (SETF #<span style="color: #b0c4de;">:AMP519</span>
                                                                (COERCE AMP
                                                                        'SAMPLE))
                                                        (SETF #<span style="color: #b0c4de;">:POS520</span>
                                                                (COERCE POS
                                                                        'SAMPLE))
                                                        (SETF #<span style="color: #b0c4de;">:BUF521</span>
                                                                *SINE-TABLE*)
                                                        (SETF #<span style="color: #b0c4de;">:FREQ-INC77525</span>
                                                                (SAMPLE-&gt;FIXNUM
                                                                 (* #<span style="color: #b0c4de;">:FREQ518</span>
                                                                    *CPS2INC*)))
                                                        (SETF #<span style="color: #b0c4de;">:PHS78526</span> 0)
                                                        (SETF #<span style="color: #b0c4de;">:MINUS-LOBITS79527</span>
                                                                (-
                                                                 (BUFFER-LOBITS
                                                                  #<span style="color: #b0c4de;">:BUF521</span>)))
                                                        (SETF #<span style="color: #b0c4de;">:DATA80528</span>
                                                                (BUFFER-DATA
                                                                 #<span style="color: #b0c4de;">:BUF521</span>))
                                                        (SETF #<span style="color: #b0c4de;">:LODIV87530</span>
                                                                (BUFFER-LODIV
                                                                 #<span style="color: #b0c4de;">:BUF521</span>))
                                                        (SETF #<span style="color: #b0c4de;">:LOMASK88531</span>
                                                                (BUFFER-LOMASK
                                                                 #<span style="color: #b0c4de;">:BUF521</span>))
                                                        (SETF #<span style="color: #b0c4de;">:MASK86532</span>
                                                                (BUFFER-MASK
                                                                 #<span style="color: #b0c4de;">:BUF521</span>))
                                                        (SETF #<span style="color: #b0c4de;">:ALPHA535</span>
                                                                (* +HALF-PI+
                                                                   #<span style="color: #b0c4de;">:POS520</span>))
                                                        (SETF #<span style="color: #b0c4de;">:LEFT536</span>
                                                                (COS
                                                                 #<span style="color: #b0c4de;">:ALPHA535</span>))
                                                        (SETF #<span style="color: #b0c4de;">:RIGHT537</span>
                                                                (SIN
                                                                 #<span style="color: #b0c4de;">:ALPHA535</span>)))
                                                       (INCUDINE.VUG::UPDATE-FREE-HOOK
                                                        #<span style="color: #b0c4de;">:NODE542</span>
                                                        #<span style="color: #b0c4de;">:FREE-HOOK541</span>)
                                                       (<span style="color: #8deeee;">PROGN</span>
                                                        (SETF #<span style="color: #b0c4de;">:PHS78526</span>
                                                                (LOGAND
                                                                 (<span style="color: #8deeee;">THE</span> FIXNUM
                                                                      (+
                                                                       #<span style="color: #b0c4de;">:PHS78526</span>
                                                                       (SAMPLE-&gt;FIXNUM
                                                                        (*
                                                                         0.0d0
                                                                         +RAD2INC+))))
                                                                 +PHASE-MASK+)))
                                                       (SETF #<span style="color: #b0c4de;">:TO-FREE540</span>
                                                               INCUDINE::*TO-FREE*)))
                                                   #<span style="color: #b0c4de;">:NODE542</span>)
                                                 <span style="color: #b0c4de;">:FREE-FUNCTION</span>
                                                 (<span style="color: #8deeee;">LAMBDA</span> ()
                                                   (FREE #<span style="color: #b0c4de;">:SMPVECW543</span>)
                                                   (FREE #<span style="color: #b0c4de;">:PTRVECW553</span>))
                                                 <span style="color: #b0c4de;">:PERF-FUNCTION</span>
                                                 (<span style="color: #8deeee;">LAMBDA</span> ()
                                                   (INCUDINE.VUG::WITH-INIT-FRAMES
                                                     (<span style="color: #8deeee;">BLOCK</span> NIL
                                                       (<span style="color: #8deeee;">LET</span> ((#<span style="color: #b0c4de;">:I69</span> 0))
                                                         (<span style="color: #8deeee;">DECLARE</span>
                                                          (TYPE CHANNEL-NUMBER
                                                           #<span style="color: #b0c4de;">:I69</span>))
                                                         (<span style="color: #8deeee;">TAGBODY</span>
                                                           (<span style="color: #8deeee;">GO</span> #<span style="color: #b0c4de;">:G71</span>)
                                                          #<span style="color: #b0c4de;">:G70</span>
                                                           (<span style="color: #8deeee;">TAGBODY</span>
                                                             (<span style="color: #8deeee;">LET</span> ((CURRENT-CHANNEL
                                                                    #<span style="color: #b0c4de;">:I69</span>))
                                                               (<span style="color: #8deeee;">DECLARE</span>
                                                                (TYPE
                                                                 CHANNEL-NUMBER
                                                                 CURRENT-CHANNEL)
                                                                (IGNORABLE
                                                                 CURRENT-CHANNEL))
                                                               (<span style="color: #8deeee;">PROGN</span>
                                                                (INCF
                                                                 (AUDIO-OUT
                                                                  CURRENT-CHANNEL)
                                                                 (SAMPLE
                                                                  (<span style="color: #8deeee;">IF</span> (=
                                                                       CURRENT-CHANNEL
                                                                       0)
                                                                      (*
                                                                       #<span style="color: #b0c4de;">:LEFT536</span>
                                                                       (SETF #<span style="color: #b0c4de;">:IN533</span>
                                                                               (<span style="color: #8deeee;">PROGN</span>
                                                                                NIL
                                                                                (<span style="color: #8deeee;">LET</span> ((#<span style="color: #b0c4de;">:INDEX81</span>
                                                                                       (<span style="color: #8deeee;">THE</span>
                                                                                        FIXNUM
                                                                                        (ASH
                                                                                         #<span style="color: #b0c4de;">:PHS78526</span>
                                                                                         #<span style="color: #b0c4de;">:MINUS-LOBITS79527</span>))))
                                                                                  (<span style="color: #8deeee;">LET</span> ((#<span style="color: #b0c4de;">:G83</span>
                                                                                         (*
                                                                                          #<span style="color: #b0c4de;">:AMP519</span>
                                                                                          (<span style="color: #8deeee;">PROGN</span>
                                                                                           (SETF #<span style="color: #b0c4de;">:FRAC85529</span>
                                                                                                   (*
                                                                                                    #<span style="color: #b0c4de;">:LODIV87530</span>
                                                                                                    (LOGAND
                                                                                                     #<span style="color: #b0c4de;">:PHS78526</span>
                                                                                                     #<span style="color: #b0c4de;">:LOMASK88531</span>)))
                                                                                           (LINEAR-INTERP
                                                                                            #<span style="color: #b0c4de;">:FRAC85529</span>
                                                                                            (SMP-REF
                                                                                             #<span style="color: #b0c4de;">:DATA80528</span>
                                                                                             #<span style="color: #b0c4de;">:INDEX81</span>)
                                                                                            (SMP-REF
                                                                                             #<span style="color: #b0c4de;">:DATA80528</span>
                                                                                             (LOGAND
                                                                                              (<span style="color: #8deeee;">THE</span>
                                                                                               FIXNUM
                                                                                               (1+
                                                                                                #<span style="color: #b0c4de;">:INDEX81</span>))
                                                                                              #<span style="color: #b0c4de;">:MASK86532</span>)))))))
                                                                                    (SETF #<span style="color: #b0c4de;">:PHS78526</span>
                                                                                            (LOGAND
                                                                                             (<span style="color: #8deeee;">THE</span>
                                                                                              FIXNUM
                                                                                              (+
                                                                                               #<span style="color: #b0c4de;">:PHS78526</span>
                                                                                               #<span style="color: #b0c4de;">:FREQ-INC77525</span>))
                                                                                             +PHASE-MASK+))
                                                                                    #<span style="color: #b0c4de;">:G83</span>)))))
                                                                      (<span style="color: #8deeee;">IF</span> (=
                                                                           CURRENT-CHANNEL
                                                                           1)
                                                                          (*
                                                                           #<span style="color: #b0c4de;">:RIGHT537</span>
                                                                           #<span style="color: #b0c4de;">:IN533</span>)
                                                                          (<span style="color: #8deeee;">THE</span>
                                                                           T
                                                                           +SAMPLE-ZERO+)))))
                                                                (VALUES))))
                                                           (PSETQ #<span style="color: #b0c4de;">:I69</span>
                                                                    (1+ #<span style="color: #b0c4de;">:I69</span>))
                                                          #<span style="color: #b0c4de;">:G71</span>
                                                           (<span style="color: #8deeee;">IF</span> (&gt;= #<span style="color: #b0c4de;">:I69</span>
                                                                   *NUMBER-OF-OUTPUT-BUS-CHANNELS*)
                                                               NIL
                                                               (<span style="color: #8deeee;">GO</span> #<span style="color: #b0c4de;">:G70</span>))
                                                           (<span style="color: #8deeee;">RETURN-FROM</span> NIL
                                                             NIL))))
                                                     (VALUES))))
                   (INCUDINE.UTIL::FINALIZE
                    (INCUDINE.VUG::DSP-INIT-FUNCTION #<span style="color: #b0c4de;">:DSP538</span>)
                    (<span style="color: #8deeee;">LAMBDA</span> ()
                      (FUNCALL (INCUDINE.VUG::DSP-FREE-FUNCTION #<span style="color: #b0c4de;">:DSP538</span>))
                      (INCUDINE.VUG::%%FREE-DSP-INSTANCE #<span style="color: #b0c4de;">:DSP538</span>)))
                   (VALUES (INCUDINE.VUG::DSP-INIT-FUNCTION #<span style="color: #b0c4de;">:DSP538</span>)
                           (INCUDINE.VUG::DSP-PERF-FUNCTION #<span style="color: #b0c4de;">:DSP538</span>))))))))))))</pre>

      <p>
        The generated code is divided in the following parts:
      </p>

      <ul>
        <li>Initialization</li>
        <li>Creation of the hash-table for the control parameters.</li>
        <li>Function definition to re-initialize a DSP instance.</li>
        <li>Function definition to free the memory when the game is over.</li>
        <li>Function definition to perform on each tick.</li>
      </ul>

      <p>
        The <code>FREE-DSP-INSTANCES</code> function frees the cached DSP instances.
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (free-dsp-instances)
<span class="prompt">SCRATCH&gt;</span> (get-foreign-sample-free-size)
67102464
<span class="prompt">SCRATCH&gt;</span> (get-rt-memory-free-size)
67102464</pre>

      <p>
        <code>GET-FOREIGN-SAMPLE-FREE-SIZE</code> returns the number of
        bytes that can be allocated from the foreign memory pool used to
        allocate arrays of samples in DSP and UGEN instances from the
        real-time thread. We can set the related memory pool size by
        changing the value of the configuration variable
        <code>*FOREIGN-SAMPLE-POOL-SIZE*</code> in <code>${HOME}/.incudinerc</code>
        (the default is 64MB).
      </p>

      <p>
        <code>GET-RT-MEMORY-FREE-SIZE</code> returns the free available memory
        allocable in realtime, without considering the allocations of SAMPLE
        type counted by <code>GET-FOREIGN-SAMPLE-FREE-SIZE</code>. We can set
        the size of the related memory pool by changing the value of
        <code>*FOREIGN-RT-MEMORY-POOL-SIZE*</code> in <code>${HOME}/.incudinerc</code>
        (the default is 64MB).
      </p>

      <p>
        The function <code>DESTROY-DSP</code> removes a DSP definition and
        all the associated memory.
      </p>

      <p>
        The function <code>ALL-DSP-NAMES</code> returns all the defined DSPs.
        We can use the combination of <code>DESTROY-DSP</code> and <code>ALL-DSP-NAMES</code>
        to remove all the defined DSP:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (mapc #'destroy-dsp (all-dsp-names))
<span class="prompt">SCRATCH&gt;</span> (all-dsp-names)
NIL</pre>

      <p>
        <a href="index.html">Incudine</a> has some facilities for diagnostics.
        There are four levels for the logger:
      </p>

      <ul>
        <li>error</li>
        <li>warn</li>
        <li>info</li>
        <li>debug</li>
      </ul>

      <p>
        Every level in the list enables the previous levels. It means that if
        <code>LOGGER-LEVEL</code> is <code>:DEBUG</code>, all the levels are
        enabled. If <code>LOGGER-LEVEL</code> is <code>:ERROR</code>, only the
        error messages are enabled. The default is <code>:WARN</code>.
      </p>

      <p>
        <code>*LOGGER-STREAM*</code> and <code>*LOGGER-FORCE-OUTPUT-P*</code>
        default to <code>*STANDARD-OUTPUT*</code> and <code>T</code>, respectively.
      </p>

      <p>
        Some examples:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (logger-level)
<span style="color: #b0c4de;">:WARN</span>
<span class="prompt">SCRATCH&gt;</span> (msg error <span style="color: #ffa07a;">"wrong direction"</span>)
ERROR: wrong direction
NIL
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"the DSP can explode"</span>)
WARN: the DSP can explode
NIL
<span class="prompt">SCRATCH&gt;</span> (msg info <span style="color: #ffa07a;">"new group ~A"</span> (1+ (random 100)))
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:info</span>)
<span style="color: #b0c4de;">:INFO</span>
<span class="prompt">SCRATCH&gt;</span> (msg info <span style="color: #ffa07a;">"new group ~A"</span> (1+ (random 100)))
new group 42
NIL
<span class="prompt">SCRATCH&gt;</span> (msg debug <span style="color: #ffa07a;">"the value of FREQ is ~,2F"</span> (random 1000.0))
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:debug</span>)
<span style="color: #b0c4de;">:DEBUG</span>
<span class="prompt">SCRATCH&gt;</span> (msg debug <span style="color: #ffa07a;">"the value of FREQ is ~,2F"</span> (random 1000.0))
DEBUG: the value of FREQ is 826.75
NIL
<span class="prompt">SCRATCH&gt;</span> (msg info <span style="color: #ffa07a;">"free all nodes"</span>)
free all nodes
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:error</span>)
<span style="color: #b0c4de;">:ERROR</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"a wolf!"</span>)
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:warn</span>)
<span style="color: #b0c4de;">:WARN</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"a wolf!"</span>)
WARN: a wolf!
NIL
<span class="prompt">SCRATCH&gt;</span> (msg error <span style="color: #ffa07a;">"unknown device"</span>)
ERROR: unknown device
NIL</pre>

      <p>
        The <code>LOGGER-TIME</code> function returns the time unit used for the
        log messages. Should be one of <code>:SEC</code>, <code>:SAMP</code> or
        <code>NIL</code> (default). <code>LOGGER-TIME</code> is setfable.
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (logger-time)
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time) <span style="color: #b0c4de;">:sec</span>)
<span style="color: #b0c4de;">:SEC</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"too late"</span>)
13878.763 WARN: too late
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time) <span style="color: #b0c4de;">:samp</span>)
<span style="color: #b0c4de;">:SAMP</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"too late"</span>)
667113472.0 WARN: too late
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time-function)
               (<span style="color: #8deeee;">lambda</span> ()
                 (<span style="color: #8deeee;">let</span> ((seconds-p (eq (logger-time) <span style="color: #b0c4de;">:sec</span>)))
                   (format *logger-stream* <span style="color: #ffa07a;">"[~:[~,1F~;~,3F~]] "</span> seconds-p
                           (* (now) (<span style="color: #8deeee;">if</span> seconds-p *sample-duration* 1))))))
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"LOGGER-TIME-FUNCTION redefined"</span>)
[675466240.0] WARN: LOGGER-TIME-FUNCTION redefined
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time-function) nil)
#&lt;FUNCTION INCUDINE.UTIL::DEFAULT-LOGGER-TIME-FUNCTION&gt;
<span class="prompt">SCRATCH&gt;</span> (setf (logger-time) nil)
NIL</pre>

      <p>
        We have to use <code>NRT-MSG</code> instead of <code>MSG</code>
        to write messages from <code>rt-thread</code>, the thread of the audio cycle.
        For example:
      </p>

      <pre class="src"><span class="prompt">SCRATCH&gt;</span> (rt-eval () (msg warn <span style="color: #ffa07a;">"Don't use MSG from rt-thread!"</span>)) <span style="color: #ff7f24;">; </span><span style="color: #ff7f24;">wrong</span>
WARN: Don't use MSG from rt-thread!
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:info</span>)
<span style="color: #b0c4de;">:INFO</span>
<span class="prompt">SCRATCH&gt;</span> (rt-eval () (nrt-msg info <span style="color: #ffa07a;">"NRT-MSG is ok from rt-thread"</span>))
NRT-MSG is ok from rt-thread
NIL
<span class="prompt">SCRATCH&gt;</span> (setf (logger-level) <span style="color: #b0c4de;">:warn</span>)
<span style="color: #b0c4de;">:WARN</span>
<span class="prompt">SCRATCH&gt;</span> (msg warn <span style="color: #ffa07a;">"~A"</span> (map 'string #'code-char '(84 72 69 32 69 78 68)))
WARN: THE END</pre>

      <hr>
      <table class="navtutor">
        <tr>
          <td style="width: 20%" class="left"><a href="tutorial_03.html">Part 3</a></td>
          <td style="width: 60%" class="center"><a href="index.html">Home</a></td>
          <td style="width: 20%" class="right"></td>
        </tr>
      </table>
    </div>
    <div id="postamble">
      <a href="http://sourceforge.net/projects/incudine">Sourceforge project page</a>
    </div>
  </body>
</html>
